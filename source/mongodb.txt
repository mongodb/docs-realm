.. _mongodb-service:

======================
MongoDB Atlas Overview
======================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

Overview
--------

Realm provides a first-class service interface for MongoDB Atlas that
lets you securely query one or more Atlas clusters. You can use standard
MongoDB query language syntax to access your data directly in your
client application code or from a Realm :doc:`Function </functions>`.

The MongoDB service secures your data with a dynamic, role-based
:guilabel:`Rules` engine that proxies and modifies incoming queries
based on rules that you define. There are three types of MongoDB
collection rules: :ref:`roles <mongodb-roles>`, :ref:`filters
<mongodb-filters>`, and :ref:`document schemas <mongodb-schemas>`.

Get Started
~~~~~~~~~~~

To get started with the MongoDB service, :doc:`link a cluster to your
application </mongodb/link-a-cluster>` and :doc:`define roles and
permissions </mongodb/define-roles-and-permissions>` for a collection.
After you've created at least one role, you can start to work with data
in the collection.

Concepts
--------

.. _crud-aggregation-operations:

CRUD & Aggregation Operations
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Realm allows you to securely work with data in a MongoDB Atlas cluster
directly from your client applications and :doc:`Functions </functions>`
using standard, platform-idiomatic MongoDB query syntax.

The following guides demonstrate how to use :doc:`MongoDB service
actions </mongodb/mongodb-actions>` to work with data in a linked
cluster:

- :doc:`Add Data to MongoDB </mongodb/add-data-to-mongodb>`
- :doc:`Find Documents in MongoDB </mongodb/find-documents-in-mongodb>`
- :doc:`Update Documents in MongoDB </mongodb/update-documents-in-mongodb>`
- :doc:`Delete Documents from MongoDB </mongodb/delete-documents-from-mongodb>`
- :doc:`Watch for Document Changes </mongodb/watch>`
- :doc:`Run Aggregation Pipelines </mongodb/run-aggregation-pipelines>`

.. admonition:: Define Collection Rules
   :class: important

   Realm dynamically determines which documents and fields
   in a collection each :doc:`application user </users>` can
   read and write for all incoming query operations by
   evaluating :ref:`collection rules <mongodb-rules>` that
   you define.

   **If you do not define rules for a collection, queries on
   the collection will fail.**

.. admonition:: Advanced MongoDB Queries
   :class: note

   Realm does not support all MongoDB CRUD and Aggregation
   operations when you query MongoDB as a specific
   :doc:`user </users>`. You can bypass this limitation by
   querying MongoDB from a :doc:`Function </functions>` that
   runs as the :ref:`system user <system-user>`, which has
   access to the full MongoDB CRUD and Aggregation APIs.

   For more information on which operations are unsupported,
   see :doc:`CRUD & Aggregation APIs
   </mongodb/crud-and-aggregation-apis>`.

.. _mongodb-rules:

Collection Rules
~~~~~~~~~~~~~~~~

In traditional applications, an application server exposes
an API to client applications and handles database queries
on their behalf. To prevent malicious, improper, or
incorrect read and write operations, clients don't query the
database directly.

Realm provides a configurable and dynamic rules engine that
enables you to run a MongoDB query from client applications
while transparently preventing unauthorized reads and
writes. Rules are defined for entire collections in a linked
MongoDB Atlas cluster and apply to individual documents in
the collection dynamically based on the :doc:`application
user </users>` that issued a query.

The rules engine handles incoming queries with the following 4-step
process:

.. include:: /includes/steps/mdb-rules-process.rst

Considerations
--------------

System-Generated Cluster Users
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Realm automatically creates a :manual:`MongoDB user
</core/security-users>` for each app linked to a cluster.
These users are for internal use only and cannot be edited
or manually deleted. If you delete a Realm app, the
associated user will also be deleted.

Users generated by Realm have names of the form:
``mongodb-realm-<your app id>``

Accessing Application Data with Another Tool
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Realm connects to standard MongoDB Atlas clusters, which
means that you can connect directly to a linked cluster
using another tool such as the :binary:`~bin.mongo` shell or
|compass|_. There are no special considerations when reading
data from a linked cluster with another tool.

While running update operations, Realm temporarily adds a
reserved field, ``_id_realm_transaction``, to documents.
Once a document is successfully updated, Realm removes this
field. If you want to use another tool to modify data in a
collection, ensure that you :manual:`$unset
</reference/operator/update/unset>` this field prior to
making changes.

For example, if you are using the :program:`mongo` shell to
update documents in the products collection, your command
might resemble the following code:

.. code-block:: sh
   :emphasize-lines: 3

   db.products.update(
      { sku: "unknown" },
      { $unset: { _id_realm_transaction: "" } }
   )


Related Content
---------------

Configuration Guides
~~~~~~~~~~~~~~~~~~~~

.. toctree::
   :caption: Configure MongoDB
   :titlesonly:
   :includehidden:
   :hidden:

   Link a MongoDB Atlas Cluster </mongodb/link-a-cluster>

.. list-table::
   :header-rows: 1
   :widths: 20 50

   * - Guide
     - Description

   * - :doc:`Link a MongoDB Atlas Cluster </mongodb/link-a-cluster>`
     - Learn how to connect a MongoDB Atlas cluster to your application.

   * - :doc:`Define Roles and Permissions </mongodb/define-roles-and-permissions>`
     - Learn how to set up role based data access controls on your
       MongoDB collections.

   * - :doc:`Filter Incoming Queries </mongodb/filter-incoming-queries>`
     - Learn how to add additional query parameters to incoming queries
       to secure data and improve query efficiency.

   * - :doc:`Enforce a Document Schema </mongodb/enforce-a-document-schema>`
     - Learn how to specify a schema that controls the shape and
       contents of documents in a collection.

   * - :doc:`Configure Advanced Rules </mongodb/configure-advanced-rules>`
     - Learn how to specify complex MongoDB collection rules by
       modifying the underlying configuration file directly in the
       Realm UI.

   * - :doc:`Specify Cluster Read Preference </mongodb/specify-cluster-read-preference>`
     - Learn how to specify which replica set members Realm reads data
       from.

   * - :doc:`Enable Wire Protocol Connections </mongodb/enable-wire-protocol-connections>`
     - Learn how to enable connections to Realm through standard
       MongoDB clients and drivers.

Usage Guides
~~~~~~~~~~~~

.. toctree::
   :caption: Work With MongoDB
   :titlesonly:
   :includehidden:
   :hidden:

   Run Aggregation Pipelines </mongodb/run-aggregation-pipelines>

.. list-table::
   :header-rows: 1
   :widths: 20 50

   * - Guide
     - Description

   * - :doc:`Add Data to MongoDB </mongodb/add-data-to-mongodb>`
     - Learn how to insert one or more documents into a MongoDB
       collection.

   * - :doc:`Find Documents </mongodb/find-documents-in-mongodb>`
     - Learn how to find documents in a collection, including
       patterns and operators that you can use to refine your query.

   * - :doc:`Update Documents </mongodb/update-documents-in-mongodb>`
     - Learn how to update documents in a collection, including
       operators for manipulating specific fields.

   * - :doc:`Delete Documents </mongodb/delete-documents-from-mongodb>`
     - Learn how to remove one or more documents from a MongoDB
       collection.

   * - :doc:`Watch for Document Changes </mongodb/watch>`
     - Learn how to use the ``watch`` API to notify browser-based
       applications when specific documents change.

   * - :doc:`Run Aggregation Pipelines </mongodb/run-aggregation-pipelines>`
     - Learn how to execute an :manual:`aggregation pipeline
       </core/aggregation-pipeline>` on a collection to calculate
       summary statistics and manipulate documents.

   * - :doc:`Connect Over the Wire Protocol </mongodb/connect-over-the-wire-protocol>`
     - Learn how to connect to MongoDB through Realm using standard
       MongoDB driver clients.

Reference Documentation
~~~~~~~~~~~~~~~~~~~~~~~

.. toctree::
   :caption: Reference
   :titlesonly:
   :includehidden:
   :hidden:

   MongoDB Actions </mongodb/actions>
   Document Schemas </mongodb/document-schemas>
   Query Filters </mongodb/query-filters>
   Connection Strings </mongodb/connection-strings>
   Service Limitations </mongodb/service-limitations>
   CRUD & Aggregation APIs </mongodb/crud-and-aggregation-apis>

.. list-table::
   :header-rows: 1
   :widths: 20 50

   * - Guide
     - Description

   * - :doc:`MongoDB Actions </mongodb/mongodb-actions>`
     - Look up detailed examples and parameters for all MongoDB service
       actions.

   * - :doc:`Query Roles </mongodb/query-roles>`
     - Learn how Realm uses role-based permission sets to control CRUD
       permissions. See examples of :guilabel:`Apply When` and
       permission sets for common use cases.

   * - :doc:`Query Filters </mongodb/query-filters>`
     - Learn how Realm dynamically applies filters to optimize queries
       and secure data.

   * - :doc:`Document Schemas </mongodb/document-schemas>`
     - Learn how Realm uses JSON schemas to control and validate the
       shape and contents of documents in a collection.

   * - :doc:`Connection Strings </mongodb/connection-strings>`
     - Look up the components of the connection strings used to
       :doc:`connect to Realm over the wire protocol
       </mongodb/connect-over-the-wire-protocol>`.

   * - :doc:`Service Limitations </mongodb/service-limitations>`
     - Learn about MongoDB features that Realm currently does not
       support and possible workarounds.

   * - :doc:`CRUD & Aggregation APIs </mongodb/crud-and-aggregation-apis>`
     - Look up support for specific MongoDB client operations in
       Realm.
