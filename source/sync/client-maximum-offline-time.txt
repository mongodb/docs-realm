.. _client-maximum-offline-time:
.. _backend-compaction:

===========================
Client Maximum Offline Time
===========================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

Overview
--------

The **client maximum offline time** controls how long a client can
remain offline between synchronization sessions with the {+backend+}
backend. Clients that do not synchronize with the backend for more than
the specified number of days must perform a :ref:`client reset
<client-resets>` the next time they connect with the backend.

Key Concepts
------------

The {+service-short+} backend keeps a history of :ref:`changes to
underlying data <changesets>`, similar to the :manual:`MongoDB oplog
</core/replica-set-oplog/>`. Client {+client-database+} instances and
the {+backend+} backend use this history to synchronize data as changes
occur on distributed clients.

In order for synchronization to converge at the same end state
as the backend and all other clients, a synchronization client requires
the full history of changes beginning immediately after the client's last
synchronization session. When a client does not check in for a long
period of time, the end of history stored on that client can predate
the beginning of the history of changes stored in the backend. When the
client does not have access to the entire history, it cannot synchronize.

As a result, the client must complete a client reset before it can
resume synchronization. In a client reset scenario, the client deletes
the client-local copy of a {+realm+} and downloads the current state of
that {+realm+} from the backend. Synchronization then resumes from that
moment.

The client maximum offline time of your {+app+} controls the number of
days of changeset history your app maintains. As a result, any clients
who have not synchronized data in *more than client maximum offline time
days* must perform a client reset the next time they connect with the
backend.

Set the Client Maximum Offline Time
-----------------------------------

.. tabs-realm-admin-interfaces::
   
   .. tab::
      :tabid: ui
      
      1. Select the :guilabel:`Sync` menu in the sidebar.

      2. Click the :guilabel:`Client Maximum Offline Time (Optional)` dropdown
         in the "Configuration" tab.

         .. figure:: /images/client-maximum-offline-time.png
           :width: 750px
           :alt: The client maximum offline time configuration in a disabled state.

      3. Click the :guilabel:`Enable Max Offline Time` toggle.

      4. Enter a number greater than or equal to 1 specifying a number of
         days for your application's client maximum offline time. The default
         value is 30 days.
   
   .. tab::
      :tabid: cli
      
      1. Pull a local copy of the latest version of your app with the
         following:

         .. code-block:: bash

            realm-cli pull --remote="<Your App ID>"

      2. You can configure the number of days for your application's
         client maximum offline time with the ``client_max_offline_days``
         property in your app's ``sync/config.json`` file:

         .. code-block:: json
            :caption: sync/config.json
           
            {
               "client_max_offline_days": 42,
            }

      3. Deploy the updated app configuration with the following:

         .. code-block:: bash

            realm-cli push --remote="<Your App ID>"
