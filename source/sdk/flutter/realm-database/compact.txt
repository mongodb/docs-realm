.. _flutter-compact:

=============================
Compact a Realm - Flutter SDK
=============================

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

The size of a Realm Database file is always larger than the total size of 
the objects stored within it. This architecture enables some of realm's 
great performance, concurrency, and safety benefits.

Realm writes new data within unused space tracked inside the file. In some 
situations, unused space may comprise a significant portion of a realm file. 
If file size grows large enough to negatively impact performance, you can 
compact the realm to reduce its file size.

.. tip:: Implement Compaction in Your Production Application

   Every production application should implement compaction to periodically 
   reduce the realm file size.

You can define a :flutter-sdk:`shouldCompactCallback() 
<realm/LocalConfiguration/shouldCompactCallback.html>` as a property of a 
local realm configuration. This callback takes two ``int`` values representing 
the total number of bytes and the used bytes of the realm file on disk. The 
most basic usage is to define a file size at which compaction should occur.

.. literalinclude:: /examples/generated/flutter/compact_realm_test.snippet.compact-with-callback.dart
   :language: dart

You can define more complex logic if you need to optimize performance for 
different use cases. For example, you could set a threshold for compaction
when a certain percentage of the file size is used.

.. literalinclude:: /examples/generated/flutter/compact_realm_test.snippet.compact-with-callback-and-logic.dart
   :language: dart
