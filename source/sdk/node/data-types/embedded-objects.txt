.. _node-data-types-embedded-objects:

==============================
Embedded Objects - Node.js SDK
==============================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

Overview
--------

An embedded object is a special type of :ref:`Realm object <node-object-schemas>`
that models complex data about a specific object. Embedded objects are similar
to :ref:`relationships <node-client-relationships>`, but they provide additional
constraints and map more naturally to the denormalized :manual:`MongoDB document
model </core/data-modeling-introduction/>`.

Realm enforces unique ownership constraints that treat each embedded object as
nested data inside of a single, specific parent object. An embedded object
inherits the lifecycle of its parent object and cannot exist as an independent
Realm object. This means that embedded objects cannot have a primary key and
that Realm automatically deletes embedded objects if their parent object is
deleted.

.. tip:: Embedded object types are reusable and composable

   You can use the same embedded object type in multiple parent object types and
   you can embed objects inside of other embedded objects. You can even
   recursively reference an embedded object type as an optional property in its
   own definition.

.. note:: Realm Uses Cascading Deletes for Embedded Objects
   
   When you delete a Realm object, Realm automatically deletes any
   embedded objects referenced by that object. Any objects that your
   application must persist after the deletion of their parent object
   should use :ref:`relationships <node-client-relationships>`
   instead.

Realm Object Models
~~~~~~~~~~~~~~~~~~~

To specify that a Realm object model define an embedded object, set ``embedded``
to ``true``. You can reference an embedded object type from parent object types
in the same way as you would define a relationship:

.. important::
   
   Embedded objects cannot have a :ref:`primary key <node-primary-keys>`.

.. code-block:: javascript
   :emphasize-lines: 3, 18, 28
   
   const AddressSchema = {
     name: "Address",
     embedded: true, // default: false
     properties: {
       street: "string?",
       city: "string?",
       country: "string?",
       postalCode: "string?",
     },
   };
   
   const ContactSchema = {
     name: "Contact",
     primaryKey: "_id",
     properties: {
       _id: "objectId",
       name: "string",
       address: "Address", // Embed a single object
     },
   };
   
   const BusinessSchema = {
     name: "Business",
     primaryKey: "_id",
     properties: {
       _id: "objectId",
       name: "string",
       addresses: { type: "list", objectType: "Address" }, // Embed an array of objects
     },
   };

JSON Schema
~~~~~~~~~~~

.. include:: /includes/embedded-object-json-schema.rst


Read and Write Embedded Objects
-------------------------------

Create an Embedded Object
~~~~~~~~~~~~~~~~~~~~~~~~~

To create an embedded object, assign an instance of the embedded object
to a parent object's property:

Update an Embedded Object Property
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To update a property in an embedded object, modify the property in a
write transaction:

Overwrite an Embedded Object
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To overwrite an embedded object, reassign the embedded object property
of a party to a new instance in a write transaction:

Query a Collection on Embedded Object Properties
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Use dot notation to filter or sort a :ref:`collection
<node-results-collections>` of objects based on an embedded object
property value:

.. include:: /includes/directly-query-embedded-objects-note.rst
