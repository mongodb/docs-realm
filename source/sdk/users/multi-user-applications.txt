.. _sdks-multi-user-applications:

=======================
Multi-User Applications
=======================

.. meta::
   :description: Build an app that supports multiple users, including the ability switch the active user, with Atlas Device SDK.
   :keywords: Realm, Flutter SDK, Kotlin SDK, Java SDK, .NET SDK, Node.js SDK, Swift SDK, code example

.. facet::
  :name: genre
  :values: reference

.. facet::
   :name: programming_language
   :values: csharp, dart, java, javascript/typescript, kotlin, swift

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

.. tabs-selector:: drivers

Atlas Device SDK allows multiple :ref:`users <user-accounts>` to be logged in
to an app simultaneously on a given device. Client applications run
in the context of a single active user even if multiple users are logged in
simultaneously. You can quickly switch between authenticated users without
requiring them to log in again.

.. important::

   C++ does not currently support multi-user applications.

.. important::
   
   **Any logged-in user may become the active user without re-authenticating.**
   Depending on your app, this may be a security vulnerability. For example, a
   user on a shared device may switch to a coworker's logged in account without
   providing their credentials or requiring their explicit permission. If your
   application requires stricter authentication, avoid switching between users
   and prefer to explicitly log the active user out before authenticating
   another user.

.. _sdks-multi-user-user-account-states:

User Account States
-------------------

When a user first logs in through Atlas App Services on a given device or
browser, the SDK saves the user's information and keeps track of the user's
state on the device. The user's data remains on the device, even if they log
out, unless you actively remove the user.

The following states describe an on-device user at any given time:

- **Authenticated:** any user that has logged in on the device
  and has not logged out or had its session revoked.
  
  - **Active**: a single authenticated user that is currently using the
    app on a given device. The SDK associates this user with outgoing
    requests and Atlas evaluates data access permissions and runs Functions in
    this user's context. See :ref:`active user <active-user>` for more
    information.
   
  - **Inactive**: all authenticated users that are not the current
    active user. You switch the active user to a currently inactive user at
    any time.

- **Logged Out:** any user that authenticated on the device but
  has since logged out or had their session revoked.

The following diagram shows how users within a client app
transition between states when certain events occur:

.. figure:: /images/multi-user.png
   :alt: A diagram the outlines the different states a user can be in: logged out, logged in and active, & logged in and inactive.

.. _sdks-multi-user-account-check-user-state:

Check User State
~~~~~~~~~~~~~~~~

The SDK provides a property you can check to determine the user's current state.

.. tabs-drivers::

   .. tab::
      :tabid: csharp

      .. include:: /includes/api-details/csharp/users/multi-user-applications-check-user-state-description.rst
      
   .. tab::
      :tabid: dart

      .. include:: /includes/api-details/dart/users/multi-user-applications-check-user-state-description.rst

   .. tab::
      :tabid: java

      .. include:: /includes/api-details/java/users/multi-user-applications-check-user-state-description.rst

   .. tab::
      :tabid: java-kotlin

      .. include:: /includes/api-details/java/users/multi-user-applications-check-user-state-description.rst

   .. tab::
      :tabid: javascript

      .. include:: /includes/api-details/javascript/users/multi-user-applications-check-user-state-js-ts-description.rst

   .. tab::
      :tabid: kotlin

      .. include:: /includes/api-details/kotlin/users/multi-user-applications-check-user-state-description.rst

   .. tab::
      :tabid: swift

      .. include:: /includes/api-details/swift/users/multi-user-applications-check-user-state-description.rst

   .. tab::
      :tabid: typescript

      .. include:: /includes/api-details/javascript/users/multi-user-applications-check-user-state-js-ts-description.rst

.. include:: /includes/sdk-examples/users/multi-user-applications-check-user-state.rst

.. _sdks-multi-user-add-new-user-to-device:

Add a New User to the Device
----------------------------

The SDK automatically adds users to a device when they log in for the first
time on that device. When a user logs in, they immediately become the
application's active user. For details about authenticating a user, refer to
:ref:`sdks-authenticate-users`.

.. TODO: Add an API description to the Dart tab in the consolidation gaps follow-up ticket when we update the code example

.. tabs-drivers::

   .. tab::
      :tabid: csharp

      .. include:: /includes/api-details/csharp/users/multi-user-applications-add-user-to-device-description.rst

   .. tab::
      :tabid: dart


   .. tab::
      :tabid: java

      .. include:: /includes/api-details/java/users/multi-user-applications-add-user-to-device-description.rst

   .. tab::
      :tabid: java-kotlin

      .. include:: /includes/api-details/java/users/multi-user-applications-add-user-to-device-description.rst

   .. tab::
      :tabid: javascript

      .. include:: /includes/api-details/javascript/users/multi-user-applications-add-user-to-device-js-ts-description.rst

   .. tab::
      :tabid: kotlin

      .. include:: /includes/api-details/kotlin/users/multi-user-applications-add-user-to-device-description.rst

   .. tab::
      :tabid: swift

      .. include:: /includes/api-details/swift/users/multi-user-applications-add-user-to-device-description.rst

   .. tab::
      :tabid: typescript

      .. include:: /includes/api-details/javascript/users/multi-user-applications-add-user-to-device-js-ts-description.rst

.. include:: /includes/sdk-examples/users/multi-user-applications-add-new-user-to-device.rst

.. _sdks-multi-user-list-all-users-on-device:

List All Users on the Device
----------------------------

You can access a list of all :ref:`user accounts <user-accounts>` that are
stored on the device. This list includes all users that have logged in to the
app on a given device regardless of whether they are currently authenticated.

.. tabs-drivers::

   .. tab::
      :tabid: csharp

      .. include:: /includes/api-details/csharp/users/multi-user-applications-list-all-users-on-device-description.rst
      
   .. tab::
      :tabid: dart

      .. include:: /includes/api-details/dart/users/multi-user-applications-list-all-users-on-device-description.rst

   .. tab::
      :tabid: java

      .. include:: /includes/api-details/java/users/multi-user-applications-list-all-users-on-device-description.rst

   .. tab::
      :tabid: java-kotlin

      .. include:: /includes/api-details/java/users/multi-user-applications-list-all-users-on-device-description.rst

   .. tab::
      :tabid: javascript

      .. include:: /includes/api-details/javascript/users/multi-user-applications-list-all-users-on-device-js-ts-description.rst

   .. tab::
      :tabid: kotlin

      .. include:: /includes/api-details/kotlin/users/multi-user-applications-list-all-users-on-device-description.rst

   .. tab::
      :tabid: swift

      .. include:: /includes/api-details/swift/users/multi-user-applications-list-all-users-on-device-description.rst

   .. tab::
      :tabid: typescript

      .. include:: /includes/api-details/javascript/users/multi-user-applications-list-all-users-on-device-js-ts-description.rst

.. include:: /includes/sdk-examples/users/multi-user-applications-list-all-users-on-device.rst

.. _sdks-multi-user-get-active-user:

Get the Active User
-------------------

You can get the current active user in your app. If multiple users are
logged in, this returns the last valid user that logged in to the device. This
method returns the language's implementation of ``nil`` or ``null`` if there
are no logged-in users.

.. tabs-drivers::

   .. tab::
      :tabid: csharp

      .. include:: /includes/api-details/csharp/users/multi-user-applications-get-active-user-description.rst
      
   .. tab::
      :tabid: dart

      .. include:: /includes/api-details/dart/users/multi-user-applications-get-active-user-description.rst

   .. tab::
      :tabid: java

      .. include:: /includes/api-details/java/users/multi-user-applications-get-active-user-description.rst

   .. tab::
      :tabid: java-kotlin

      .. include:: /includes/api-details/java/users/multi-user-applications-get-active-user-description.rst

   .. tab::
      :tabid: javascript

      .. include:: /includes/api-details/javascript/users/multi-user-applications-get-active-user-js-ts-description.rst

   .. tab::
      :tabid: kotlin

      .. include:: /includes/api-details/kotlin/users/multi-user-applications-get-active-user-description.rst

   .. tab::
      :tabid: swift

      .. include:: /includes/api-details/swift/users/multi-user-applications-get-active-user-description.rst

   .. tab::
      :tabid: typescript

      .. include:: /includes/api-details/javascript/users/multi-user-applications-get-active-user-js-ts-description.rst

.. include:: /includes/sdk-examples/users/multi-user-applications-get-active-user.rst

.. _sdks-multi-user-change-active-user:

Change the Active User
----------------------

You can change an app's :ref:`active user <active-user>` to another
logged-in user at any time.

.. tabs-drivers::

   .. tab::
      :tabid: csharp

      .. include:: /includes/api-details/csharp/users/multi-user-applications-change-active-user-description.rst
      
   .. tab::
      :tabid: dart

      .. include:: /includes/api-details/dart/users/multi-user-applications-change-active-user-description.rst

   .. tab::
      :tabid: java

      .. include:: /includes/api-details/java/users/multi-user-applications-change-active-user-description.rst

   .. tab::
      :tabid: java-kotlin

      .. include:: /includes/api-details/java/users/multi-user-applications-change-active-user-description.rst

   .. tab::
      :tabid: javascript

      .. include:: /includes/api-details/javascript/users/multi-user-applications-change-active-user-js-ts-description.rst

   .. tab::
      :tabid: kotlin

      .. include:: /includes/api-details/kotlin/users/multi-user-applications-change-active-user-not-supported.rst

   .. tab::
      :tabid: swift

      .. include:: /includes/api-details/swift/users/multi-user-applications-change-active-user-description.rst

   .. tab::
      :tabid: typescript

      .. include:: /includes/api-details/javascript/users/multi-user-applications-change-active-user-js-ts-description.rst

.. include:: /includes/sdk-examples/users/multi-user-applications-change-active-user.rst

.. _sdks-multi-user-log-user-out:

Log a User Out
--------------

You can log a logged-in user out of an app. Once logged out, the user is still
stored on the device but must log back in to use the app. If another logged-in
user exists on the device, logging a user out automatically sets the remaining
logged-in user as the active user.

.. tabs-drivers::

   .. tab::
      :tabid: csharp

      .. include:: /includes/api-details/csharp/users/multi-user-applications-log-user-out-description.rst

   .. tab::
      :tabid: dart

      .. include:: /includes/api-details/dart/users/multi-user-applications-log-user-out-description.rst

   .. tab::
      :tabid: java

      .. include:: /includes/api-details/java/users/multi-user-applications-log-user-out-description.rst

   .. tab::
      :tabid: java-kotlin

      .. include:: /includes/api-details/java/users/multi-user-applications-log-user-out-description.rst

   .. tab::
      :tabid: javascript

      .. include:: /includes/api-details/javascript/users/multi-user-applications-log-user-out-js-ts-description.rst

   .. tab::
      :tabid: kotlin

      .. include:: /includes/api-details/kotlin/users/multi-user-applications-log-user-out-description.rst

   .. tab::
      :tabid: swift

      .. include:: /includes/api-details/swift/users/multi-user-applications-log-user-out-description.rst

   .. tab::
      :tabid: typescript

      .. include:: /includes/api-details/javascript/users/multi-user-applications-log-user-out-js-ts-description.rst

.. include:: /includes/sdk-examples/users/multi-user-applications-log-user-out.rst

For more information, refer to :ref:`sdks-logout`.

.. _sdks-multi-user-remove-user-from-device:

Remove a User from the Device
-----------------------------

You can remove all information about a user from the device and automatically
log the user out. Once removed, the user must re-authenticate to use the app
again. This *does not* delete the user from Atlas. If another logged-in
user exists on the device, removing a user out automatically sets the remaining
logged-in user as the active user.

.. tabs-drivers::

   .. tab::
      :tabid: csharp

      .. include:: /includes/api-details/csharp/users/multi-user-applications-remove-user-from-device-description.rst
      
   .. tab::
      :tabid: dart

      .. include:: /includes/api-details/dart/users/multi-user-applications-remove-user-from-device-description.rst

   .. tab::
      :tabid: java

      .. include:: /includes/api-details/java/users/multi-user-applications-remove-user-from-device-description.rst

   .. tab::
      :tabid: java-kotlin

      .. include:: /includes/api-details/java/users/multi-user-applications-remove-user-from-device-description.rst

   .. tab::
      :tabid: javascript

      .. include:: /includes/api-details/javascript/users/multi-user-applications-remove-user-from-device-js-ts-description.rst

   .. tab::
      :tabid: kotlin

      .. include:: /includes/api-details/kotlin/users/multi-user-applications-remove-user-from-device-description.rst

   .. tab::
      :tabid: swift

      .. include:: /includes/api-details/swift/users/multi-user-applications-remove-user-from-device-description.rst

   .. tab::
      :tabid: typescript

      .. include:: /includes/api-details/javascript/users/multi-user-applications-remove-user-from-device-js-ts-description.rst

.. include:: /includes/sdk-examples/users/multi-user-applications-remove-user-from-device.rst

For more information on removing and deleting users, refer to
:ref:`sdks-create-and-delete-users`.
