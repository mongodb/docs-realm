.. _cpp-react-to-changes:

==================================
React to Changes - C++ SDK (Alpha)
==================================

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

.. _cpp-register-an-object-change-listener:

Register an Object Change Listener
----------------------------------

You can register a notification handler on a specific object
within a realm. Realm Database notifies your handler:

- When the object is deleted.
- When any of the object's properties change.

.. code-block:: cpp
   :copyable: false
   
   auto token = object.observe([&](auto&& change) { ... }

The handler receives an :cpp-sdk:`ObjectChange <structrealm_1_1ObjectChange.html>`
object that contains information about the changes, such as whether the 
object was deleted. It may include a list 
of :cpp-sdk:`PropertyChange 
<structrealm_1_1PropertyChange.html#a71dc45a7609e6a528e70b91d20ef8f94>` 
objects that contain information about what fields changed, the new values
of those fields (except on List properties), and potentially the old values 
of the fields.

.. literalinclude:: /examples/generated/cpp/examples.snippet.notifications-property-changes.cpp
    :language: cpp

When you make changes, :cpp-sdk:`refresh() <structrealm_1_1db.html>` the 
realm to emit a notification.

.. example::

   .. literalinclude:: /examples/generated/cpp/examples.snippet.notifications-object.cpp
      :language: cpp

.. _cpp-register-a-results-collection-change-listener:

Register a Results Collection Change Listener
---------------------------------------------

You can register a notification handler on a :cpp-sdk:`results collection
<structrealm_1_1results.html>`.

Realm Database notifies your handler whenever a write transaction 
removes, adds, or changes objects in the collection.

Notifications describe the changes since the prior notification with
three lists of indices: the indices of the objects that were deleted,
inserted, and modified.

.. important:: Order Matters
   
   In collection notification handlers, always apply changes
   in the following order: deletions, insertions, then
   modifications. Handling insertions before deletions may
   result in unexpected behavior.
  
Results collection notifications provide a :cpp-sdk:`results_change 
<structrealm_1_1results__base_1_1results__change.html>` struct that 
reports the index of the objects that are deleted, added, or modified.
It can also notify you if the collection was deleted.

.. literalinclude:: /examples/generated/cpp/examples.snippet.notifications-results.cpp
   :language: cpp

.. _cpp-stop-watching-for-changes:

Stop Watching for Changes
-------------------------

Observation stops when the token returned by an ``observe`` call becomes
invalid. You can explicitly invalidate a token by calling its
``unregister()`` member function.

.. important:: Retain Tokens as Long as You Want to Observe

   Notifications stop if the token is in a local variable that goes out
   of scope. 

.. literalinclude:: /examples/generated/cpp/examples.snippet.notifications-unregister.cpp
   :language: cpp
