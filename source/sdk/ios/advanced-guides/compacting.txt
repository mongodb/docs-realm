.. _ios-client-compact-a-realm:

=========================
Compact a Realm - iOS SDK
=========================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

Overview
--------

The size of a {+client-database+} file is always larger than the total 
size of the objects stored within it. This architecture enables some of 
{+realm+}'s great performance, concurrency, and safety benefits. 

To avoid making expensive system calls, {+realm+} files are rarely 
shrunk at runtime. Instead, they grow by specific size increments. 
{+backend-short+} writes new data within unused space tracked inside the file. 
In some situations, unused space may comprise a significant portion of a 
{+realm+} file. 

.. _ios-how-to-compact-a-realm:

Compact a Realm
~~~~~~~~~~~~~~~

Use ``shouldCompactOnLaunch()`` or on a {+realm+}'s configuration object 
to compact a {+realm+}. Specify conditions to execute this method, such 
as:

- The size of the file on disk
- How much free space the file contains

.. important:: Compacting may not occur

   If another process is accessing the {+realm+}, compacting does not occur. 
   It doesn't matter if the configuration block's conditions apply. 
   Compacting cannot be safely performed while a {+realm+} is being accessed.

.. tabs-realm-languages::

   .. tab::
      :tabid: swift

      For more info, see: :swift-sdk:`shouldCompactOnLaunch()<Structs/Realm/Configuration.html>`

      .. literalinclude:: /examples/generated/code/start/Compacting.codeblock.compacting.swift
        :language: swift

   .. tab::
      :tabid: objective-c

      For more info, see: :objc-sdk:`shouldCompactOnLaunch<Classes/RLMRealmConfiguration.html#/c:objc(cs)RLMRealmConfiguration(py)shouldCompactOnLaunch`

      .. literalinclude:: /examples/generated/code/start/Compacting.codeblock.compacting.m
        :language: objectivec

.. _ios-how-compacting-works:

How Compacting Works
~~~~~~~~~~~~~~~~~~~~

{+backend-short+} compacting works by:

1. Reading the entire contents of the {+realm+} file
2. Writing the contents to a new file at a different location
3. Replacing the original file

If the file contains a lot of data, this can be an expensive operation.

Best Practices
~~~~~~~~~~~~~~

Experiment with conditions to find the right balance of how often to 
compact a {+realm+} file. Because the operation can be 
expensive, don't compact every time you open a {+realm+}. Do compact 
often enough to prevent the file size from growing too large.

Summary
-------

- {+client-database+}'s architecture enables benefits, but can result in 
  file size growth.

- Use compacting to manage file size growth.

- Define conditions for ``shouldCompactOnLaunch()`` to compact a {+realm+}.

- Compacting cannot occur if another process is accessing the {+realm+}.
