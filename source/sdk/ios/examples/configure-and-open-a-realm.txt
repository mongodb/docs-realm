.. _ios-configure-and-open-a-realm:

==================================
Configure & Open a Realm - iOS SDK
==================================

A **{+realm+}** is the core data structure used to organize data in
{+client-database+}. For more information, see :ref:`ios-realms`.

.. _ios-open-a-local-realm:

Open a Local Realm
------------------

.. tabs-realm-languages::
   
   .. tab::
      :tabid: swift

      You can open a realm with the :swift-sdk:`Realm() initializer
      <Structs/Realm.html#/s:10RealmSwift0A0V13configuration5queueA2C13ConfigurationV_So012OS_dispatch_D0CSgtKcfc>`.
      If you omit the :swift-sdk:`Realm.Configuration
      <Structs/Realm/Configuration.html>` parameter, you will open the
      default realm. You can use the configuration object to open a
      realm at a specific file URL, in memory, or with :ref:`{+sync+}
      <sync>`.

      You can set the default realm configuration by assigning a new
      Realm.Configuration instance to the
      :swift-sdk:`Realm.Configuration.defaultConfiguration
      <Structs/Realm/Configuration.html#/s:10RealmSwift0A0V13ConfigurationV07defaultC0AEvpZ>`
      class property.

      .. literalinclude:: /examples/generated/code/start/OpenCloseRealm.codeblock.open-local-realm.swift
         :language: swift

   .. tab::
      :tabid: objective-c

      You can open the default realm with :objc-sdk:`+[RLMRealm
      defaultRealm]
      <Classes/RLMRealm.html#/c:objc(cs)RLMRealm(cm)defaultRealm>`.
      
      You can also pass a :objc-sdk:`RLMRealmConfiguration
      <Classes/RLMRealmConfiguration.html>` object to
      :objc-sdk:`+[RLMRealm realmWithConfiguration:error:]
      <Classes/RLMRealm.html#/c:objc(cs)RLMRealm(cm)realmWithConfiguration:error:>`
      to open a realm at a specific file URL, in memory, or with
      :ref:`{+sync+} <sync>`.

      You can set the default realm configuration by passing a
      RLMRealmConfiguration instance to 
      :objc-sdk:`+[RLMRealmConfiguration setDefaultConfiguration:]
      <Classes/RLMRealmConfiguration.html#/c:objc(cs)RLMRealmConfiguration(cm)setDefaultConfiguration:>`.

      .. literalinclude:: /examples/generated/code/start/OpenCloseRealm.codeblock.open-local-realm.m
         :language: objectivec

.. _ios-close-a-realm:

Close a Realm
-------------

There is no need to manually close a {+realm+} in Swift or Objective-C.
When a {+realm+} goes out of scope and is removed from memory due to
`ARC
<https://docs.swift.org/swift-book/LanguageGuide/AutomaticReferenceCounting.html>`__,
the {+realm+} is closed.

.. _ios-open-an-in-memory-realm:

Open an In-Memory Realm
-----------------------

You can open a realm entirely in memory, which will not create a
``.realm`` file or its associated :ref:`auxiliary files
<ios-realm-file>`. Instead the SDK stores objects in memory while the
{+realm+} is open and discards them immediately when all instances are
closed.

.. tabs-realm-languages::
   
   .. tab::
      :tabid: swift

      Set the :swift-sdk:`inMemoryIdentifier
      <Structs/Realm/Configuration.html#/s:10RealmSwift0A0V13ConfigurationV18inMemoryIdentifierSSSgvp>`
      property of the realm configuration. Note that this property
      cannot be combined with ``fileURL`` or ``syncConfiguration``.

      .. literalinclude:: /examples/generated/code/start/OpenCloseRealm.codeblock.open-in-memory-realm.swift
         :language: swift

   .. tab::
      :tabid: objective-c

      Set the :objc-sdk:`inMemoryIdentifier
      <Classes/RLMRealmConfiguration.html#/c:objc(cs)RLMRealmConfiguration(py)inMemoryIdentifier>`
      property of the realm configuration. Note that this property
      cannot be combined with ``fileURL`` or ``syncConfiguration``.

      .. literalinclude:: /examples/generated/code/start/OpenCloseRealm.codeblock.open-in-memory-realm.m
         :language: objectivec


.. _ios-provide-a-subset-of-classes-to-a-realm:

Provide a Subset of Classes to a Realm
--------------------------------------

.. tip:: Operating with Low Memory Constraints
   
   Some applications, such as watchOS apps and iOS app extensions, have
   tight constraints on their memory footprints. To optimize your data
   model for low-memory environments, open the {+realm+} with a subset
   of classes.

.. tabs-realm-languages::
   
   .. tab::
      :tabid: swift

      By default, the iOS SDK automatically adds all
      :swift-sdk:`Object<Extensions/Object.html>`- and
      :swift-sdk:`EmbeddedObject<Extensions/EmbeddedObject.html>`-derived
      classes in your executable to the realm schema. You can control
      which objects get added by setting the :swift-sdk:`objectTypes
      <Structs/Realm/Configuration.html#/s:10RealmSwift0A0V13ConfigurationV11objectTypesSaySo13RLMObjectBaseCmGSgvp>`
      property of the :swift-sdk:`Realm.Configuration
      <Structs/Realm/Configuration.html>` object.

      .. literalinclude:: /examples/generated/code/start/OpenCloseRealm.codeblock.configure-object-types.swift
         :language: swift

   .. tab::
      :tabid: objective-c

      By default, the iOS SDK automatically adds all
      :objc-sdk:`RLMObject<Classes/RLMObject.html>`- and
      :objc-sdk:`RLMEmbeddedObject<Classes/RLMEmbeddedObject.html>`-derived
      classes in your executable to the realm schema. You can control
      which objects get added by setting the :objc-sdk:`objectClasses
      <Classes/RLMRealmConfiguration.html#/c:objc(cs)RLMRealmConfiguration(py)objectClasses>`
      property of the :objc-sdk:`RLMRealmConfiguration
      <Classes/RLMRealmConfiguration.html>` object.

      .. literalinclude:: /examples/generated/code/start/OpenCloseRealm.codeblock.configure-object-types.m
         :language: objectivec


.. _ios-realm-api-properties:

Initialize Properties Using Realm APIs
--------------------------------------

You might define properties whose values are initialized using
{+client-database+} APIs. For example:

.. code-block:: swift

   class SomeSwiftType {
       let persons = try! Realm().objects(Person.self)
       // ...
   }

If this initialization code runs before you set up your Realm
configurations, you might get unexpected behavior. For example, if you
set a :ref:`migration <ios-migrations>` block for the default {+realm+}
configuration in ``applicationDidFinishLaunching()``, but you create an
instance of ``SomeSwiftType`` before
``applicationDidFinishLaunching()``, you might be accessing your
{+realm+} before it has been correctly configured.

To avoid such issues, consider doing one of the following:

- Defer instantiation of any type that eagerly initializes properties using {+client-database+} APIs until after your app has completed setting up its {+realm+} configurations. 
- Define your properties using Swift’s ``lazy`` keyword. This allows you to safely instantiate such types at any time during your application’s lifecycle, as long as you do not attempt to access your ``lazy`` properties until after your app has set up its {+realm+} configurations.
- Only initialize your properties using Realm APIs that explicitly take in user-defined configurations. You can be sure that the configuration values you are using have been set up properly before they are used to open {+realms+}.

.. _use-realm-when-the-device-is-locked:

Use Realm When the Device Is Locked
-----------------------------------

By default, iOS 8 and above encrypts app files using
``NSFileProtection`` whenever the device is locked. If your app attempts
to do any work on a {+realm+} while the device is locked, you might see
the following error:

.. code-block:: text

   open() failed: Operation not permitted

To handle this, you can downgrade the file protection of the folder [1]_
containing :ref:`the Realm file itself and its auxiliary files
<ios-realm-file>` to a less strict protection level that allows file
access even when the device is locked, such as
:apple:`NSFileProtectionCompleteUntilFirstUserAuthentication
</documentation/foundation/nsfileprotectioncompleteuntilfirstuserauthentication>`.

.. tip::

   If you choose to opt out of complete iOS file encryption in this way,
   we encourage you to use Realm's own :ref:`built-in encryption
   <ios-encrypt-a-realm>` to secure your data.

The following example shows how to apply a less strict protection level
to the parent directory of the default {+realm+}:

.. literalinclude:: /examples/generated/code/start/Encrypt.codeblock.background-app-refresh-encryption.swift
   :language: swift

.. seealso::
   
   :ref:`ios-sync-changes-in-the-background`

.. [1] It is recommended that you apply the file protection attribute to
   the folder containing the Realm files rather than to the specific
   files themselves. {+service-short+} may create and deletes auxiliary
   files at any time. By applying the file protection attribute to the
   parent folder, you can ensure the file protection applies to all of
   the relevant files, regardless of when they were created.
