.. _react-native-use-realm-react:

======================
@realm/react Reference
======================

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 3
   :class: singlecol

:npm:`@realm/react <package/@realm/react>` is an npm package that streamlines
common Realm operations like querying, writing to a realm, and listening to
realm objects. This reduces boilerplate code, like creating your own listeners
and state management.

``@realm/react`` provides access to Realm through a set of providers that have
various hooks. The hooks update React state when the Realm data changes.
This means that components using these hooks rerender on any changes to data
in the realm.

.. include:: /includes/note-realmreact-version-requirements-for-realmjs.rst

.. _react-native-setup-realm-hooks:

Set Up @realm/react
-------------------

To set up ``@realm/react``, start with a new `bare React Native app 
<https://reactnative.dev/docs/environment-setup#creating-a-new-application>`_ 
or use the :github:`Realm Expo template <expo/examples/tree/master/with-realm>`.

You can also install ``@realm/react`` for existing React Native apps.

Add @realm/react to a New App
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

You can start with a new bare React Native app  or use the :github:`Realm Expo 
template <expo/examples/tree/master/with-realm>`.

The React Native SDK documentation generally assumes that you're using a bare
React Native app and not Expo.

To create a bare React Native app:

#. Follow the `React Native documentation 
   <https://reactnative.dev/docs/environment-setup#creating-a-new-application>`_.
#. Install ``@realm/react``.

   .. code-block:: shell

      npm install @realm/react

To create a new app with ``@realm/react`` and Expo, follow the :ref:`Quick Start
with Expo <react-native-client-bootstrap-with-expo>` documentation.

Add @realm/react to an Existing App
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To install ``@realm/react`` on an existing React Native application, run the
following command in your terminal from the root of your application
where your ``package.json`` file is located:

.. code-block:: shell

    npm install @realm/react

.. _react-native-realm-provider:

RealmProvider
-------------

.. code:: typescript
   :copyable: false
   :caption: Type signature

   RealmProvider(props, context?): null | ReactElement<any, any>

Components nested within ``RealmProvider`` can access the configured realm
and use the ``RealmProvider`` hooks.

**Props**

All properties of :realm-react-sdk:`BaseConfiguration 
<types/Realm.BaseConfiguration.html>` can be passed as props.

.. code:: typescript
   :copyable: false

   BaseConfiguration: {
      deleteRealmIfMigrationNeeded?: boolean;
      disableFormatUpgrade?: boolean;
      encryptionKey?: ArrayBuffer | ArrayBufferView | Int8Array;
      fifoFilesFallbackPath?: string;
      inMemory?: boolean;
      onMigration?: MigrationCallback;
      path?: string;
      readOnly?: boolean;
      schema?: (RealmObjectConstructor<AnyRealmObject> | ObjectSchema)[];
      schemaVersion?: number;
      shouldCompact?: ((totalBytes, usedBytes) => boolean);
      sync?: SyncConfiguration;
   }

``RealmProvider`` has more props that define its behavior:

.. code:: typescript
   :copyable: false

   ProviderProps: {
      // The fallback component to render if the Realm is not opened.
      fallback?: React.ComponentType<unknown> | React.ReactElement | null | undefined;
      // Default is ``true``. If false, realm will not close when the
      // component unmounts.
      closeOnUnmount?: boolean;
      // A ref to the realm instance. This is useful if you need to
      // access the realm instance outside of the scope of the realm.
      realmRef?: React.MutableRefObject<Realm | null>;
      children: React.ReactNode;
   }
   

Configure RealmProvider
~~~~~~~~~~~~~~~~~~~~~~~

.. tabs::

   .. tab:: Configure realm with sync
      :tabid: configure-sync-realm
   
      Configure a synced realm using the providers from ``@realm/react``.

      By default, Realm syncs all data from the server before returning anything.
      If you want to sync data in the background, read :ref:`Configure a Synced Realm
      While Offline <react-native-open-synced-realm-offline>`.

      To configure a synced realm:

      #. Import providers from ``@realm/react``.
      #. Configure ``AppProvider``.
      #. Configure ``UserProvider`` and nest it within ``AppProvider``.
      #. Configure ``RealmProvider`` for sync and nest it within ``UserProvider``.

      You must set up a sync subscription. The example below uses an initial subscription,
      but you can also set up subscriptions in ``RealmProvider`` child components.

      This is how you nest providers:

      .. literalinclude:: /examples/generated/react-native/ts/configure-realm-sync.test.snippet.configure-realm-sync-full.tsx
        :language: javascript

      For for information about configuring a synced realm, refer to
      :ref:`Configure a Synced Realm <react-native-synced-realm>`.

   .. tab:: Configure realm without sync
      :tabid: configure-non-sync-realm
   
      :realm-react-sdk:`RealmProvider <functions/RealmProvider.html>` is a wrapper
      that exposes a realm to its child components. You configure your realm by
      passing props to ``RealmProvider``.

      When ``RealmProvider`` is rendered, it opens the realm. This means that the
      provider renders successfully or its child components can't access the realm.

      To configure a non-synced realm:

      #. Import ``RealmProvider`` from ``@realm/react``.
      #. Pass your object models to the ``schema`` prop.
      #. Add other :realm-react-sdk:`Configuration object <types/Realm.BaseConfiguration.html>` 
         properties as props to ``RealmProvider`` to configure your realm.

      .. literalinclude:: /examples/generated/react-native/ts/configure-realm-local.test.snippet.configure-realm.tsx
        :language: typescript

Configure More Than One Realm
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

When you import ``RealmProvider`` from ``@realm/react``, that provider has a
specific context and is associated with a single realm. If you need to configure
more than one realm, use ``createRealmContext()`` to instantiate a new provider
for each realm.

If you import ``useRealm()``, ``useQuery()``, or ``useObject()`` directly from
``@realm/react``, those hooks use the default realm context. To work with more
than one realm, you need to destructure a new realm provider and its associated
hooks from the result of ``createRealmContext()``. You should namespace providers
to avoid confusion about which provider and hooks you're working with.

For a detailed guide, refer to :ref:`Expose more than one realm 
<react-native-expose-multiple-realms>`.

For a details about ``createRealmContext()``, refer to :ref:`createRealmContext() 
<react-native-realm-context>` on this page.

RealmProvider Hooks
-------------------

.. _react-native-use-realm-hook:

useRealm()
~~~~~~~~~~

.. code:: typescript
   :copyable: false
   :caption: Type signature

   useRealm(): Realm 

The ``useRealm()`` hook returns an opened realm instance. The realm instance
gives you access to realm methods and properties. For example, you can call
``realm.write()`` to add a realm object to your realm.

.. literalinclude:: /examples/generated/react-native/ts/create-test.test.snippet.crud-create-object.tsx
   :language: typescript
   :emphasize-lines: 3, 6-8, 15

To learn more about modifying Realm data, refer to :ref:`Write Transactions
<react-native-write-transactions>`.

.. _react-native-use-object-hook:

useObject()
~~~~~~~~~~~

.. code:: typescript
   :copyable: false
   :caption: Type signature

   useObject<T>(type, primaryKey): T & Realm.Object<T> | null

The ``useObject()`` hook returns a Realm object for a given
:ref:`primary key <react-native-primary-keys>`. You can pass an object class
or the class name as a string and the primary key.

The ``useObject()`` method returns null if the object doesn't exist or you have
deleted it. The hook will automatically subscribe to updates and rerender the
component using the hook on any change to the object.

.. literalinclude:: /examples/generated/react-native/ts/read.test.snippet.crud-read-object-by-id.tsx
         :language: typescript

.. _react-native-use-query-hook:

useQuery()
~~~~~~~~~~

.. code:: typescript
   :copyable: false
   :caption: Type signature

   useQuery<T>(type, query?, deps?): Realm.Results<T & Realm.Object<T>>

The ``useQuery()`` hook returns a collection of realm objects of a given type.
These are the results of your query. A query can be an object class or the class
name as a string.

The ``useQuery()`` method subscribes to updates to any objects in the collection
and rerenders the component using it on any change to the results.

You can use ``.filtered()`` and ``.sorted()`` to filter and sort your query
results. For more details, refer to the :ref:`CRUD - Read 
<react-native-read-objects>` docs.

.. literalinclude:: /examples/generated/react-native/ts/read.test.snippet.crud-read-filter-data.tsx
    :language: typescript
    :emphasize-lines: 4-6, 8-14

.. _react-native-app-provider:

AppProvider
-----------

.. code:: typescript
   :copyable: false
   :caption: Type signature

   AppProvider(props, context?): null | ReactElement<any, any>

Components nested within ``AppProvider`` can access your App Services App
and use the ``AppProvider`` hooks.

**Props**

All properties of :realm-react-sdk:`AppConfiguration 
<types/Realm.AppConfiguration.html>` can be passed as props to ``AppProvider``.

.. code:: typescript
   :copyable: false

   AppConfiguration: {
      app?: LocalAppConfiguration;
      baseFilePath?: string;
      baseUrl?: string;
      id: string;
      multiplexSessions?: boolean;
      timeout?: number;
   }

Configure AppProvider
~~~~~~~~~~~~~~~~~~~~~

To set up your App client, pass the App ID string
to the ``id`` prop of the ``AppProvider``.
Wrap any components that need to access the App with the ``AppProvider``.

.. literalinclude:: /examples/generated/react-native/ts/app-provider.test.snippet.app-provider.tsx
   :language: typescript

.. include:: /includes/multiple-app-client-details-and-app-config-cache.rst

AppProvider Hooks
-----------------

.. _react-native-use-auth:

useAuth()
~~~~~~~~~

.. code:: typescript
   :copyable: false
   :caption: Type signature

   useAuth(): UseAuth

``useAuth`` has an authentication method for every App Services
authentication provider.

result
``````

.. code:: typescript
   :copyable: false
   :caption: Type signature

   result: AuthResult

Result of authentication hook operation. For example, ``result.operation`` gives
you the name of the current operation.

**Values**

- ``state``. Can be "not-started", "pending", "success", "error".
- ``operation``. For a list of all operation names, refer to the
  :realm-react-sdk:`API documentation <enums/AuthOperationName.html>`.
- ``pending``. Can be ``true`` or ``false``.
- ``success``. Can be ``true`` or ``false``.
- ``error``. Error-based object or undefined.

logIn(credentials)
``````````````````

.. code:: typescript
   :copyable: false
   :caption: Type signature

   logIn(credentials: Realm.Credentials): void

Logs in a user with any authentication mechanism supported by
Realm. If called when a user is logged in, the current user switches to
the new user. Usually, it's better to use the more specific login
methods.

.. code:: typescript

  const {logIn, result} = useAuth();

  useEffect(() => logIn(Realm.Credentials.anonymous()), []);

  if(result.pending) {
    return (<LoadingSpinner/>)
  }

  if(result.error) {
    return (<ErrorComponent/>)
  }

  if(result.success) {
    return (<SuccessComponent/>)
  }
  //...

**Parameters**

- ``credentials``. A Realm credential supplied by any supported Realm
  authentication.

**Returns**

- ``void``

logInWithAnonymous()
````````````````````

.. code:: typescript
   :copyable: false
   :caption: Type signature

   logInWithAnonymous(): void

Log in with the anonymous authentication provider.

.. code:: typescript

   const {logInWithAnonymous, result} = useAuth();
   const performLogin = () => {
      logInWithAnonymous();
   };

**Parameters**

- none

**Returns**

- ``void``

logInWithApiKey(key)
````````````````````

.. code:: typescript
   :copyable: false
   :caption: Type signature

   logInWithApiKey(key: string): void

Log in with an API key.

.. code:: typescript

   const {logInWithApiKey, result} = useAuth();
   const performLogin = () => {
   const key = getApiKey(); // user defined function
      logInWithApiKey(key);
   };

**Parameters**

- ``key``. A string that is linked to an App Services user.

**Returns**

- ``void``

logInWithEmailPassword(credentials)
```````````````````````````````````

.. code:: typescript
   :copyable: false
   :caption: Type signature

   logInWithEmailPassword(credentials: {
     email: string;
     password: string;
   }): void

Log in with Email/Password.

.. code:: typescript

   const {logInWithEmailPassword, result} = useAuth();
   const [email, setEmail] = useState('');
   const [password, setPassword] = useState('');

   const performLogin = () => {
      logInWithEmailPassword({email, password});
   };

**Parameters**

- ``credentials``. An object with ``email`` and ``password`` fields.

**Returns**

- ``void``

logInWithJWT(credentials)
`````````````````````````

.. code:: typescript
   :copyable: false
   :caption: Type signature

   logInWithJWT(token: string): void

Log in with a JSON Web Token (JWT).
       
.. code:: typescript

   const {logInWithJWT, result} = useAuth();

   const performLogin = () => {
   const token = authorizeWithCustomerProvider(); // user defined function
      logInWithJWT(token);
   };

**Parameters**

- ``credentials``. A string representation of a user's JWT.

**Returns**

- ``void``

logInWithGoogle(credentials)
````````````````````````````

.. code:: typescript
   :copyable: false
   :caption: Type signature

   logInWithGoogle(credentials: {
        idToken: string;
    } | {
        authCode: string;
    }): void;

Log in with Google.
       
.. code:: typescript

   const {logInWithGoogle, result} = useAuth();

   const performLogin = () => {
   const token = getGoogleToken(); // user defined function
      logInWithGoogle({idToken: token});
   };

**Parameters**

- ``credentials``. An object with and ``idToken`` field that should contain
  the string token you get from Google Identity Services.

**Returns**

- ``void``

logInWithApple(idToken)
```````````````````````

.. code:: typescript
   :copyable: false
   :caption: Type signature

   logInWithApple(idToken: string): void;

Log in with Apple.
       
.. code:: typescript

   const {logInWithApple, result} = useAuth();

   const performLogin = () => {
   const token = getAppleToken(); // user defined function
      logInWithApple(token);
   };

**Parameters**

- ``idToken``. A string you get from an Apple SDK.

**Returns**

- ``void``

logInWithFacebook(accessToken)
``````````````````````````````

.. code:: typescript
   :copyable: false
   :caption: Type signature

   logInWithFacebook(accessToken: string): void;

Log in with Facebook.
       
.. code:: typescript

   const {logInWithFacebook, result} = useAuth();

   const performLogin = () => {
   const token = getFacebookToken(); // user defined function
      logInWithFacebook(token);
   };

**Parameters**

- ``accessToken``. A string you get from the Facebook SDK.

**Returns**

- ``void``

logInWithFunction(payload)
``````````````````````````

.. code:: typescript
   :copyable: false
   :caption: Type signature

   logInWithFunction<PayloadType extends Record<string, unknown>>(payload: PayloadType): void;

Log in with a custom function.
       
.. code:: typescript

   const {logInWithFunction, result} = useAuth();

   const performLogin = () => {
   const customPayload = getAuthParams(); // user defined arguments
      logInWithFunction(customPayload);
   };

**Parameters**

- ``payload``. An object that contains user information you want to pass to
  the App Services function that processes log in requests.

**Returns**

- ``void``

logOut()
````````

.. code:: typescript
   :copyable: false
   :caption: Type signature

   logOut(): void;

Logs out the current user.
       
.. code:: typescript

   const {logOut, result} = useEmailPasswordAuth();
   const performLogout = () => {
      logOut();
   }

**Parameters**

- none

**Returns**

- ``void``

useEmailPasswordAuth()
~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/realm-react-hook-emailpasswordauth.rst

.. _react-native-use-app-hook:

useApp()
~~~~~~~~

.. code:: typescript
   :copyable: false
   :caption: Type signature

   useApp<FunctionsFactoryType, CustomDataType>(): Realm.App<FunctionsFactoryType, CustomDataType>

The ``useApp()`` hook provides access to the :js-sdk:`Realm.App <Realm.App.html>`
instance.

.. literalinclude:: /examples/generated/react-native/ts/use-app.test.snippet.use-app.tsx
   :language: typescript

.. _react-native-user-provider:

UserProvider
------------

.. code:: typescript
   :copyable: false
   :caption: Type signature

   UserProvider(props, context?): null | ReactElement<any, any>

Components nested within ``UserProvider`` can access the logged-in user object
and use the ``UserProvider`` hooks.

**Props**

All properties of :realm-react-sdk:`AppConfiguration 
<types/Realm.AppConfiguration.html>` can be passed as props to ``AppProvider``.

.. code:: typescript
   :copyable: false

   UserProviderProps {
      /**
      * The fallback component to render if there is no authorized user.
      * This can be used to render a log in screen or otherwise handle
      * authentication.
      */
      fallback?: React.ComponentType<unknown> | React.ReactElement | null | undefined;
      children: React.ReactNode;
   }

Configure UserProvider
~~~~~~~~~~~~~~~~~~~~~~

Components wrapped by :realm-react-sdk:`AppProvider <functions/AppProvider.html>`
can access the :realm-react-sdk:`useApp <functions/useApp.html>` and
:realm-react-sdk:`useAuth <functions/useAuth.html>` hooks. These components only
render if ``AppProvider`` successfully connects to your App Services backend.

Components wrapped by :realm-react-sdk:`UserProvider <functions/UserProvider.html>`
can access authenticated users with the :realm-react-sdk:`useUser 
<functions/useUser.html>` hook. These components only render if your app has an
authenticated user

To configure user authentication:

#. Wrap all components that need to access App Services in ``AppProvider``.
#. Inside of ``AppProvider``, wrap all components that you want to have access
   to an authenticated user with ``UserProvider``.
#. In ``UserProvider``, include a ``fallback`` prop with a component
   that logs a user in. The app renders this component if there
   is no authenticated user.

.. include:: /examples/generated/react-native/v12/RealmWrapper.snippet.configure-user-provider.tsx.rst

UserProvider Hooks
------------------

.. _react-native-use-user-hook:

useUser()
~~~~~~~~~

.. code:: typescript
   :copyable: false
   :caption: Type signature

   useUser<FunctionsFactoryType, CustomDataType, UserProfileDataType>(): Realm.User<FunctionsFactoryType, CustomDataType, UserProfileDataType>

The ``useUser()`` hook provides access to the logged-in user. For example,
you can use ``useUser()`` to log the current user out.

.. include:: /examples/generated/react-native/v12/RealmWrapper.snippet.log-user-out.tsx.rst

.. _react-native-realm-context:

createRealmContext()
--------------------

.. code:: typescript
   :copyable: false
   :caption: Type signature

   createRealmContext(realmConfig?): RealmContext

Most of the time, you will only use ``createRealmContext()`` if you need to
configure more than one realm. Otherwise, you should import``RealmProvider``
and hooks directly from ``@realm/react``.

The ``createRealmContext()`` method creates a :reactjs:`React Context
<docs/context.html>` object for a realm with a given
:realm-react-sdk:`Configuration <types/Realm.BaseConfiguration.html>`. The
``Context`` object contains the following: 

- A :reactjs:`Context Provider <docs/context.html#contextprovider>` (referred to
  as ``RealmProvider`` elsewhere) component that wraps around a child components
  and provides them with access to hooks.
- Various prebuilt :reactjs:`Hooks <docs/hooks-intro.html>` that access the
  configured realm.

For a detailed guide, refer to :ref:`Expose more than one realm 
<react-native-expose-multiple-realms>`.
