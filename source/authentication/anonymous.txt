========================
Anonymous Authentication
========================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

Overview
--------

The Anonymous authentication provider allows users to log in to your
application without providing credentials. Each time someone
authenticates anonymously, the provider generates a new anonymous user
object for that session. Anonymous user objects have a unique ID value
but no other metadata fields or configuration options.

Potential use cases for anonymous authentication include:

- Authenticating the readers of a blog or news service.

- Allowing end users to try the features of an application before
  registering for an account.

- Simplifying the creation of users while developing and testing the
  client application.

Account Linking
---------------
An Anonymous user object is not intended to be reused, and once a user logs out,
they will not be able to retrieve any previous user data. For this reason, you
should not use Anonymous authentication in a situation where you want to
persist a user's data. Instead, you can associate an existing Anonymous
identity with a user account created by a different authentication
provider. Linking these identities allows you to persist the data from the
anonymous account. See :doc:`/authentication/linking` for more information on
how to accomplish this.

.. cssclass:: important
.. admonition:: Anonymous user expiration

   Stitch may delete an Anonymous user object that is 90 days old (or
   older). When an account is deleted, it is not recoverable, and any associated
   user data is lost. Documents created or modified by the user remain unaffected.


Configuration
-------------

.. tabs-stitch-interfaces::

   tabs:
     - id: stitch-ui
       content: |
         You can enable the Anonymous authentication provider from the
         Stitch UI by selecting :guilabel:`Anonymous` from the
         :guilabel:`Users > Providers` page.

     - id: import-export
       content: |
         You can enable the Anonymous authentication provider with
         :doc:`stitch-cli </deploy/stitch-cli-reference>` by
         importing an application directory that contains a
         :ref:`configuration file <appschema-authentication-providers>`
         for the provider.

         The configuration file must be named ``anon-user.json`` and
         stored in the ``/auth_providers`` directory. Configuration
         files for the Anonymous authentication provider have the
         following form:

         .. cssclass:: wide-container
         .. code-block:: none
            :caption: ``/auth_providers/anon-user.json``

            {
              "name": "anon-user",
              "type": "anon-user",
              "disabled": <boolean>,
            }

.. note::

   The anonymous authentication provider does not have any
   provider-specific configuration options.

Usage
-----

.. _auth-anonymous-client-sdks:

Authenticate a User
~~~~~~~~~~~~~~~~~~~

.. tabs-stitch-sdks::

   tabs:
     - id: javascript
       content: |
         To authenticate a user anonymously, call
         :js-sdk:`StitchAppClient.auth.loginWithCredential()
         <interfaces/stitchauth.html#loginwithcredential>` with an
         instance of :js-sdk:`AnonymousCredential <classes/anonymouscredential.html>`,
         returning a ``Promise`` instance. If the authentication
         succeeds, the ``Promise`` resolves with an
         instance of :js-sdk:`StitchUser <interfaces/stitchuser.html>`:

         .. code-block:: javascript

            Stitch.defaultAppClient.auth.loginWithCredential(new AnonymousCredential()).then(user => {
               console.log(`Logged in as anonymous user with id: ${user.id}`);
            }).catch(console.error);

     - id: android
       content: |
         To authenticate a user anonymously, instantiate an
         :android-sdk:`AnonymousCredential
         <com/mongodb/stitch/core/auth/providers/anonymous/AnonymousCredential.html>`
         and pass it as the argument to
         :android-sdk:`StitchAuth.loginWithCredential()
         <com/mongodb/stitch/android/core/auth/StitchAuth.html#loginWithCredential-com.mongodb.stitch.core.auth.StitchCredential->`.

         .. code-block:: java

            Stitch.getDefaultAppClient().getAuth().loginWithCredential(new AnonymousCredential()).addOnCompleteListener(new OnCompleteListener<StitchUser>() {
                @Override
                public void onComplete(@NonNull final Task<StitchUser> task) {
                    if (task.isSuccessful()) {
                        Log.d("stitch", "logged in anonymously");
                    } else {
                        Log.e("stitch", "failed to log in anonymously", task.getException());
                    }
            }

     - id: ios
       content: |
         To authenticate a user anonymously, call
         :ios-sdk:`StitchAuth.login()
         <Protocols/StitchAuth.html#/s:10StitchCore0A4AuthP5loginy0aB3SDK0A10Credential_p04withF0_yAA0A6ResultOyAA0A4User_pGctF>`
         with an instance of :ios-sdk:`AnonymousCredential <Structs/AnonymousCredential.html>`:

         .. code-block:: swift

            Stitch.defaultAppClient!.auth.login(withCredential: AnonymousCredential.init()) { result in
                switch result {
                case .success:
                    print("logged in anonymously")
                case .failure(let error):
                    print("failed to log in anonymously: \(error)")
                }
            }
